services:

  app:
    # Use pre-built image or build locally
    #image: 4ch1m/pixoo-rest:latest
    build: .
    ports:
      # Map host port to container port (can be different)
      # HOST_PORT defaults to CONTAINER_PORT if not set
      - ${HOST_PORT:-${CONTAINER_PORT:-5000}}:${CONTAINER_PORT:-5000}
    environment:
      - TZ=${TZ:-Europe/Berlin}
      # Pixoo device settings
      - PIXOO_HOST=${PIXOO_HOST:-Pixoo64}
      - PIXOO_SCREEN_SIZE=${PIXOO_SCREEN_SIZE:-64}
      - PIXOO_DEBUG=${PIXOO_DEBUG:-false}
      # REST API server settings
      - PIXOO_REST_HOST=0.0.0.0
      - PIXOO_REST_PORT=${CONTAINER_PORT:-5000}
      - PIXOO_TEST_CONNECTION_RETRIES=${PIXOO_TEST_CONNECTION_RETRIES:-3}
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:${CONTAINER_PORT:-5000}/health"]
      interval: 30s
      timeout: 3s
      retries: 3
      start_period: 5s
